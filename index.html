<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Dream Career</title>
    <style>
        /* --- VISUAL STYLE (CSS) --- */
        :root {
            --primary: #05ABDF;
            --primary-dark: #0277bd;
            --secondary: #4caf50;
            --bg: #e0f7fa;
            --text: #2c3e50;
        }

        body {
            font-family: 'Verdana', sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg);
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden;
        }

        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        #game-container {
            width: 100%; max-width: 500px; height: 95vh;
            background: #ffffff; border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            overflow-y: auto; position: relative;
            text-align: center; padding: 20px;
            display: flex; flex-direction: column;
            box-sizing: border-box;
        }

        /* --- POPUP & FORM STYLES --- */
        #intro-popup {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 100;
            display: flex; flex-direction: column;
            align-items: center;
            padding: 20px; box-sizing: border-box;
            overflow-y: auto;
            /* Hidden by default until logo loads */
            opacity: 0; 
            transition: opacity 0.5s ease;
        }

        /* LOGO STYLE */
        .brand-logo { 
            width: 280px; 
            height: auto; 
            margin-bottom: 10px; 
            display: block;
        }

        .popup-title { font-size: 1.8rem; color: var(--primary); margin: 5px 0 20px 0; text-transform: uppercase; line-height: 1.2; }
        .reg-form { width: 100%; max-width: 300px; display: flex; flex-direction: column; gap: 12px; }
        .input-field { padding: 12px 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; outline: none; transition: 0.3s; }
        .input-field:focus { border-color: var(--primary); background: #e1f5fe; }
        
        .btn-start {
            margin-top: 10px; padding: 15px 30px; font-size: 1.1rem;
            background: var(--primary); color: white; border: none;
            border-radius: 50px; cursor: pointer; font-weight: bold;
            box-shadow: 0 4px 0 var(--primary-dark); transition: transform 0.1s;
        }
        .btn-start:active { transform: translateY(4px); box-shadow: none; }

        /* --- GAME UI --- */
        .nav-header {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; margin-bottom: 10px;
        }

        .btn-back {
            background: #eceff1; color: #546e7a; border: none;
            padding: 8px 15px; border-radius: 20px;
            font-size: 0.9rem; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 5px;
            transition: background 0.2s;
        }
        .btn-back:hover { background: #cfd8dc; }

        .landscape { min-height: 140px; background: linear-gradient(to bottom, #4fc3f7, #81c784); border-radius: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; font-size: 4rem; position: relative;}
        h2 { color: var(--text); font-size: 1.1rem; margin: 10px 0; line-height: 1.4; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; flex-grow: 1; }
        .option-card { background: #f1f8e9; border: 2px solid #c5e1a5; border-radius: 12px; padding: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: transform 0.1s, background 0.1s; }
        .option-card:active { transform: scale(0.95); background: #dcedc8; }

        .progress-track { background: #eee; height: 8px; width: 100%; border-radius: 5px; overflow: hidden; margin-bottom: 5px; flex-grow: 1; margin-left: 10px; }
        #progress-bar { width: 0%; height: 100%; background: var(--secondary); transition: width 0.3s; }

        /* --- RESULTS --- */
        .details-box { background: #fff8e1; border-radius: 10px; padding: 15px; margin: 10px 0; text-align: left; border: 2px solid #ffe0b2; }
        .career-box { background: #e8f5e9; border-radius: 10px; padding: 15px; margin: 10px 0; text-align: left; border: 2px solid #c8e6c9; }
        .career-li { background: white; padding: 8px 12px; border-radius: 8px; font-size: 0.9rem; margin-bottom: 5px; border-left: 4px solid var(--secondary); list-style: none; }
        .hidden { display: none !important; }
        
        /* Loading Spinner for Image */
        .loader-spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--primary);
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 50px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="initial-loader" style="position:absolute; top:40%; left:0; width:100%; text-align:center; z-index: 50;">
            <div class="loader-spinner"></div>
            <p style="color:#777;">Loading Adventure...</p>
        </div>

        <div id="intro-popup">
            <img src="logo.png" alt="ICM Education" class="brand-logo" id="main-logo" onerror="this.src='https://placehold.co/300x100?text=ICM+Logo'">
            
            <div id="intro-content" class="hidden" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
                <h1 class="popup-title">FiND YOUR<br>DREAM CAREER</h1>
                
                <div class="reg-form">
                    <input type="text" id="inp-name" class="input-field" placeholder="Student Name" required>
                    <input type="text" id="inp-class" class="input-field" placeholder="Class / Grade" required>
                    <input type="number" id="inp-age" class="input-field" placeholder="Age" required>
                    <input type="text" id="inp-place" class="input-field" placeholder="Place" required>
                    <input type="tel" id="inp-phone" class="input-field" placeholder="Parent's Phone Number" required>
                    
                    <button class="btn-start" onclick="validateAndStart()">Start Adventure üöÄ</button>
                </div>
            </div>
        </div>

        <div id="game-interface" class="hidden">
            <div class="nav-header">
                <button id="btn-back" class="btn-back hidden" onclick="goBack()">‚¨Ö Back</button>
                <div class="progress-track"><div id="progress-bar"></div></div>
            </div>
            
            <div class="landscape"><span id="scene-emoji">üö©</span></div>
            <h2 id="scenario-text">Loading...</h2>
            <div class="options-grid" id="options-container"></div>
        </div>

        <div id="screen-result" class="hidden">
            <h2 style="color: var(--secondary); margin: 0; font-size: 1rem;">Analysis Complete!</h2>
            <div class="landscape" style="min-height: 90px; background: #fff; margin-bottom: 5px;">
                <span id="result-emoji" style="font-size: 3.5rem;">üèÜ</span>
            </div>
            <h1 id="result-title" style="color: var(--primary); font-size: 1.4rem; text-transform: uppercase; margin: 5px 0;">...</h1>
            
            <div class="details-box">
                <strong style="color: #e65100;">‚ö° Your Personality:</strong>
                <div id="traits-list" style="margin-top:10px; font-size:0.95rem; color:#555;"></div>
            </div>

            <div class="career-box">
                <strong style="color: #2e7d32;">üöÄ Top 5 Future Careers:</strong>
                <ul id="career-list" style="padding:0; margin-top:10px;"></ul>
            </div>
            
            <div id="save-status" style="font-size:0.8rem; color:#888; margin-bottom:10px; min-height: 20px;"></div>
            
            <button class="btn-start" onclick="location.reload()" style="font-size: 0.9rem; padding: 10px 20px;">Play Again</button>
        </div>
    </div>

    <script>
        // --- 1. SMOOTH LOADING LOGIC ---
        window.addEventListener('load', () => {
            const logo = document.getElementById('main-logo');
            const introPopup = document.getElementById('intro-popup');
            const content = document.getElementById('intro-content');
            const loader = document.getElementById('initial-loader');

            // Function to reveal UI
            const revealUI = () => {
                loader.style.display = 'none'; // Hide spinner
                introPopup.style.opacity = 1;  // Fade in container
                content.classList.remove('hidden');
                content.classList.add('fade-in'); // Trigger animation
            };

            if (logo.complete) {
                revealUI();
            } else {
                logo.onload = revealUI;
            }
        });

        // --- 2. CONFIGURATION ---
        // FIXED: Removed duplicate URL part
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwMX3bzvQa4Y8ZKUSxasxQvle82cRmfjx7XBwV_6LwyoWl-pVWx8rlJndWczaAQrLgTGw/exec"; 

        /* --- 3. USER DATA STORAGE --- */
        let userInfo = { name: "", class: "", age: "", place: "", phone: "" };

        function validateAndStart() {
            const name = document.getElementById('inp-name').value;
            const stuClass = document.getElementById('inp-class').value;
            const age = document.getElementById('inp-age').value;
            const place = document.getElementById('inp-place').value;
            const phone = document.getElementById('inp-phone').value;

            if(name === "" || stuClass === "" || age === "" || place === "" || phone === "") {
                alert("Please fill in all details to start!");
                return;
            }
            userInfo = { name, class: stuClass, age, place, phone };
            
            // UI Transition
            document.getElementById('intro-popup').style.display = 'none';
            document.getElementById('game-interface').classList.remove('hidden');
            document.getElementById('game-interface').classList.add('fade-in');
            loadScenario();
        }

        /* --- 4. GAME CONTENT --- */
        const scenarios = [
            { text: "1. Village Center: What do you build first?", emoji: "üèóÔ∏è", options: [ { label: "Machine Shop", type: "Realistic", icon: "üîß" }, { label: "Art School", type: "Artistic", icon: "üé®" }, { label: "Market", type: "Enterprising", icon: "üè™" }, { label: "Clinic", type: "Social", icon: "ü©∫" } ] },
            { text: "2. The bridge is broken! You...", emoji: "üåâ", options: [ { label: "Build a raft", type: "Realistic", icon: "ü™µ" }, { label: "Call for help", type: "Social", icon: "üì¢" }, { label: "Design a new one", type: "Artistic", icon: "üìê" }, { label: "Hire a boat", type: "Enterprising", icon: "üö§" } ] },
            { text: "3. Onam Festival role?", emoji: "üå∏", options: [ { label: "Pookalam Design", type: "Artistic", icon: "üå∫" }, { label: "Serving Food", type: "Social", icon: "üçõ" }, { label: "Stage Setup", type: "Realistic", icon: "üî®" }, { label: "Event Organizer", type: "Enterprising", icon: "üé§" } ] },
            { text: "4. Tourists need help. You...", emoji: "üì∏", options: [ { label: "Drive the Jeep", type: "Realistic", icon: "üöô" }, { label: "Tell Stories", type: "Social", icon: "üó£Ô∏è" }, { label: "Sell Souvenirs", type: "Enterprising", icon: "üí∞" }, { label: "Perform Dance", type: "Artistic", icon: "üíÉ" } ] },
            { text: "5. Lost Elephant! You...", emoji: "üêò", options: [ { label: "Build Fence", type: "Realistic", icon: "üöß" }, { label: "Comfort It", type: "Social", icon: "‚ù§Ô∏è" }, { label: "Take Photos", type: "Artistic", icon: "üì∑" }, { label: "Lead Rescue", type: "Enterprising", icon: "üö©" } ] },
            { text: "6. Coconut Harvest. You...", emoji: "ü••", options: [ { label: "Climb & Pluck", type: "Realistic", icon: "üßó" }, { label: "Count & Sell", type: "Enterprising", icon: "üìù" }, { label: "Make Crafts", type: "Artistic", icon: "ü•£" }, { label: "Share with All", type: "Social", icon: "ü§ù" } ] },
            { text: "7. School Club. You start...", emoji: "üè´", options: [ { label: "Robotics", type: "Realistic", icon: "ü§ñ" }, { label: "Drama/Music", type: "Artistic", icon: "üé≠" }, { label: "Debate Team", type: "Enterprising", icon: "‚öñÔ∏è" }, { label: "Charity Club", type: "Social", icon: "üåø" } ] },
            { text: "8. Plastic on beach. You...", emoji: "üèñÔ∏è", options: [ { label: "Make Posters", type: "Artistic", icon: "üñåÔ∏è" }, { label: "Pick it Up", type: "Realistic", icon: "üß§" }, { label: "Recycling Biz", type: "Enterprising", icon: "‚ôªÔ∏è" }, { label: "Clean Together", type: "Social", icon: "üëØ" } ] },
            { text: "9. Boat Race Role?", emoji: "üö£", options: [ { label: "The Captain", type: "Enterprising", icon: "üì¢" }, { label: "The Rower", type: "Realistic", icon: "üí™" }, { label: "Boat Decorator", type: "Artistic", icon: "‚ú®" }, { label: "Cheerleader", type: "Social", icon: "üéâ" } ] },
            { text: "10. Gift for Village?", emoji: "üéÅ", options: [ { label: "Library", type: "Social", icon: "üìö" }, { label: "Solar Plant", type: "Realistic", icon: "‚òÄÔ∏è" }, { label: "Cinema", type: "Artistic", icon: "üé¨" }, { label: "Mall", type: "Enterprising", icon: "üõçÔ∏è" } ] },
            // RAPID FIRE
            { text: "11. Pick an object!", emoji: "‚ö°", options: [ { label: "Microscope", type: "Realistic", icon: "üî¨" }, { label: "Paintbrush", type: "Artistic", icon: "üñåÔ∏è" }, { label: "Megaphone", type: "Enterprising", icon: "üì£" }, { label: "First Aid Kit", type: "Social", icon: "ü©π" } ] },
            { text: "12. Pick a workspace!", emoji: "‚ö°", options: [ { label: "Garage/Lab", type: "Realistic", icon: "‚öôÔ∏è" }, { label: "Studio", type: "Artistic", icon: "üéª" }, { label: "Office/Boardroom", type: "Enterprising", icon: "üíº" }, { label: "Hospital/School", type: "Social", icon: "üè•" } ] },
            { text: "13. Pick a hobby!", emoji: "‚ö°", options: [ { label: "Fixing Bikes", type: "Realistic", icon: "üö≤" }, { label: "Writing Songs", type: "Artistic", icon: "üìù" }, { label: "Trading Cards", type: "Enterprising", icon: "üÉè" }, { label: "Teaching Kids", type: "Social", icon: "üë∂" } ] },
            { text: "14. Pick a hero!", emoji: "‚ö°", options: [ { label: "Inventor", type: "Realistic", icon: "üí°" }, { label: "Artist", type: "Artistic", icon: "üé≠" }, { label: "CEO", type: "Enterprising", icon: "üëî" }, { label: "Activist", type: "Social", icon: "üïäÔ∏è" } ] },
            { text: "15. Final Choice!", emoji: "üåü", options: [ { label: "Tools", type: "Realistic", icon: "üî®" }, { label: "Colors", type: "Artistic", icon: "üåà" }, { label: "Money", type: "Enterprising", icon: "üí∞" }, { label: "People", type: "Social", icon: "‚ù§Ô∏è" } ] }
        ];

        let currentStep = 0;
        let scores = { Realistic: 0, Artistic: 0, Enterprising: 0, Social: 0 };
        let historyStack = []; // To track selections for the Back button

        function loadScenario() {
            if (currentStep >= scenarios.length) { showResults(); return; }
            
            // Handle Back Button Visibility
            const backBtn = document.getElementById('btn-back');
            if(currentStep === 0) {
                backBtn.classList.add('hidden');
            } else {
                backBtn.classList.remove('hidden');
            }

            const data = scenarios[currentStep];
            document.getElementById('scenario-text').innerText = data.text;
            document.getElementById('scene-emoji').innerText = data.emoji;
            
            // Create options
            // Note: We randomise options only on first load, but for simplicity here we randomise every time.
            let shuffledOptions = [...data.options].sort(() => Math.random() - 0.5);
            
            const container = document.getElementById('options-container');
            container.innerHTML = ''; // Clear previous
            
            shuffledOptions.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'option-card';
                btn.innerHTML = `<span style="font-size:1.5rem">${opt.icon}</span><strong style="margin-top:5px">${opt.label}</strong>`;
                btn.onclick = () => handleChoice(opt.type);
                container.appendChild(btn);
            });

            // Update Progress Bar
            document.getElementById('progress-bar').style.width = ((currentStep) / scenarios.length) * 100 + "%";
        }

        function handleChoice(type) { 
            scores[type]++; 
            historyStack.push(type); // Save the choice type so we can undo it
            currentStep++; 
            loadScenario(); 
        }

        function goBack() {
            if (currentStep <= 0) return;

            // 1. Remove the score from the last choice
            const lastType = historyStack.pop();
            if (lastType) {
                scores[lastType]--;
            }

            // 2. Go back a step
            currentStep--;
            loadScenario();
        }

        /* --- 5. RESULTS & DATA SUBMISSION --- */
        function showResults() {
            document.getElementById('game-interface').classList.add('hidden');
            const resScreen = document.getElementById('screen-result');
            resScreen.classList.remove('hidden');
            resScreen.classList.add('fade-in');

            let sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            let topTrait = sortedScores[0][0];
            let secondTrait = sortedScores[1][0];

            const hybridData = {
                "Realistic-Artistic": { title: "The Design Engineer üìê", career: ["Architect", "Product Designer", "Game Developer", "Animator", "Landscape Designer"] },
                "Realistic-Social": { title: "The Medical Healer ü©∫", career: ["Surgeon", "Veterinarian", "Sports Coach", "Physiotherapist", "Firefighter"] },
                "Realistic-Enterprising": { title: "The Builder Captain üèóÔ∏è", career: ["Pilot", "Civil Engineer", "Factory Manager", "Farm Owner", "Logistics Head"] },
                "Artistic-Realistic": { title: "The Digital Creator üíª", career: ["UX/UI Designer", "Sound Engineer", "Photographer", "Fashion Designer", "Chef"] },
                "Artistic-Social": { title: "The Inspiring Teacher üé≠", career: ["Drama Teacher", "Art Therapist", "Journalist", "Travel Guide", "Counselor"] },
                "Artistic-Enterprising": { title: "The Media Star üé¨", career: ["Film Director", "Advertising Head", "Event Planner", "Social Media Influencer", "Brand Manager"] },
                "Social-Realistic": { title: "The Hands-on Helper üöë", career: ["Nurse", "Police Officer", "Paramedic", "Agriculture Officer", "Zoologist"] },
                "Social-Artistic": { title: "The Storyteller üó£Ô∏è", career: ["Psychologist", "Speech Therapist", "Librarian", "Author/Writer", "Primary Teacher"] },
                "Social-Enterprising": { title: "The Team Leader ü§ù", career: ["School Principal", "HR Manager", "Hotel Manager", "NGO Leader", "TV Host"] },
                "Enterprising-Realistic": { title: "The Tech Boss üöÄ", career: ["Startup Founder", "Stock Trader", "Real Estate Developer", "Tech CEO", "Bank Manager"] },
                "Enterprising-Artistic": { title: "The Visionary üí°", career: ["Marketing Director", "Creative Director", "Fashion Buyer", "Talent Agent", "Publicist"] },
                "Enterprising-Social": { title: "The Public Leader üèõÔ∏è", career: ["Politician", "Lawyer", "Social Entrepreneur", "Hospital Admin", "Diplomat"] }
            };

            let key = topTrait + "-" + secondTrait;
            // Fallback if score is 0 or unexpected
            let profile = hybridData[key] || { title: "The Master " + topTrait, career: ["Specialist in " + topTrait, "Researcher", "Consultant", "Analyst", "Innovator"] };

            document.getElementById('result-title').innerText = profile.title;
            
            const traitSentences = {
                "Realistic": "You like using tools, fixing broken things, and understanding how machines work.",
                "Artistic": "You have a colorful imagination and love to create new things or ideas.",
                "Social": "You are a kind friend who loves helping people and solving their problems.",
                "Enterprising": "You are brave, confident, and you like leading your team to success."
            };

            document.getElementById('traits-list').innerHTML = `
                <div style="margin-bottom:5px">‚úÖ ${traitSentences[topTrait] || "Balanced Personality"}</div>
                <div>‚ú® ${traitSentences[secondTrait] || "Versatile Skills"}</div>
            `;
            
            const cList = document.getElementById('career-list');
            cList.innerHTML = "";
            profile.career.forEach(c => { cList.innerHTML += `<li class="career-li">${c}</li>`; });

            // TRIGGER DATA SAVE
            sendDataToGoogleScript(profile.title, topTrait, scores);
        }

        function sendDataToGoogleScript(resultTitle, topTrait, fullScores) {
            const statusBox = document.getElementById('save-status');
            statusBox.innerText = "Saving result...";

            const dataPayload = {
                Name: userInfo.name,
                Class: userInfo.class, 
                Age: userInfo.age,
                Place: userInfo.place,
                Phone: userInfo.phone,
                Result: resultTitle,
                Top_Score: topTrait,
                Scores_Detail: JSON.stringify(fullScores)
            };

            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors", 
                headers: { "Content-Type": "text/plain" },
                body: JSON.stringify(dataPayload)
            }).then(() => {
                statusBox.innerText = "‚úÖ Result Saved Successfully!";
                statusBox.style.color = "green";
            }).catch(err => {
                console.error(err);
                statusBox.innerText = "‚ö†Ô∏è Could not save data. Please check connection.";
                statusBox.style.color = "red";
            });
        }
    </script>
</body>
</html>
