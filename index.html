<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Dream Career</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* --- VISUAL STYLE (CSS) --- */
        :root {
            --primary: #05ABDF;
            --primary-dark: #0277bd;
            --secondary: #4caf50;
            --bg: #e0f7fa;
            --text: #2c3e50;
        }

        body {
            font-family: 'Verdana', sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg);
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden;
        }

        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in { animation: fadeIn 0.8s ease-out forwards; }

        #game-container {
            width: 100%; max-width: 500px; height: 95vh;
            background: #ffffff; border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            overflow-y: auto; position: relative;
            text-align: center; padding: 20px;
            display: flex; flex-direction: column;
            box-sizing: border-box;
        }

        /* --- POPUPS --- */
        #intro-popup, #lang-popup {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 100;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 20px; box-sizing: border-box;
            transition: opacity 0.5s ease;
        }
        
        #intro-popup.hidden-anim, #lang-popup.hidden-anim {
            opacity: 0; pointer-events: none;
        }

        /* LOGO STYLE */
        .brand-logo { width: 280px; height: auto; margin-bottom: 10px; display: block; }

        .popup-title { font-size: 1.8rem; color: var(--primary); margin: 5px 0 20px 0; text-transform: uppercase; line-height: 1.2; }
        .reg-form { width: 100%; max-width: 300px; display: flex; flex-direction: column; gap: 12px; }
        .input-field { padding: 12px 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; outline: none; transition: 0.3s; }
        .input-field:focus { border-color: var(--primary); background: #e1f5fe; }
        
        .btn-start, .btn-lang {
            margin-top: 10px; padding: 15px 30px; font-size: 1.1rem;
            background: var(--primary); color: white; border: none;
            border-radius: 50px; cursor: pointer; font-weight: bold;
            box-shadow: 0 4px 0 var(--primary-dark); transition: transform 0.1s;
        }
        .btn-start:active, .btn-lang:active { transform: translateY(4px); box-shadow: none; }

        .btn-lang { width: 100%; max-width: 250px; margin: 10px 0; background: var(--secondary); box-shadow: 0 4px 0 #388e3c; }

        /* --- GAME UI --- */
        .nav-header { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 10px; }
        .btn-back {
            background: #eceff1; color: #546e7a; border: none;
            padding: 8px 15px; border-radius: 20px;
            font-size: 0.9rem; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 5px;
            transition: background 0.2s;
        }
        .btn-back:hover { background: #cfd8dc; }

        .landscape { min-height: 140px; background: linear-gradient(to bottom, #4fc3f7, #81c784); border-radius: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; font-size: 4rem; position: relative;}
        h2 { color: var(--text); font-size: 1.1rem; margin: 10px 0; line-height: 1.4; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; flex-grow: 1; }
        .option-card { background: #f1f8e9; border: 2px solid #c5e1a5; border-radius: 12px; padding: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: transform 0.1s, background 0.1s; }
        .option-card:active { transform: scale(0.95); background: #dcedc8; }

        .progress-track { background: #eee; height: 8px; width: 100%; border-radius: 5px; overflow: hidden; margin-bottom: 5px; flex-grow: 1; margin-left: 10px; }
        #progress-bar { width: 0%; height: 100%; background: var(--secondary); transition: width 0.3s; }

        /* --- RESULTS --- */
        .details-box { background: #fff8e1; border-radius: 10px; padding: 15px; margin: 10px 0; text-align: left; border: 2px solid #ffe0b2; }
        .career-box { background: #e8f5e9; border-radius: 10px; padding: 15px; margin: 10px 0; text-align: left; border: 2px solid #c8e6c9; }
        .career-li { background: white; padding: 8px 12px; border-radius: 8px; font-size: 0.9rem; margin-bottom: 5px; border-left: 4px solid var(--secondary); list-style: none; }
        .hidden { display: none !important; }
        
        /* Loading Spinner */
        .loader-spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--primary);
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 50px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="initial-loader" style="position:absolute; top:40%; left:0; width:100%; text-align:center; z-index: 150;">
            <div class="loader-spinner"></div>
            <p style="color:#777;">Loading Adventure...</p>
        </div>

        <div id="intro-popup" style="opacity: 0;"> 
            <img src="logo.png" alt="ICM Education" class="brand-logo" id="main-logo" onerror="this.src='https://placehold.co/300x100?text=ICM+Logo'">
            
            <div id="intro-content" class="hidden" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
                <h1 class="popup-title">Find Your<br>Dream Career</h1>
                <div class="reg-form">
                    <input type="text" id="inp-name" class="input-field" placeholder="Student Name" required>
                    <input type="text" id="inp-class" class="input-field" placeholder="Class / Grade" required>
                    <input type="number" id="inp-age" class="input-field" placeholder="Age" required>
                    <input type="text" id="inp-place" class="input-field" placeholder="Place" required>
                    <input type="tel" id="inp-phone" class="input-field" placeholder="Parent's Phone Number" required>
                    <button class="btn-start" onclick="validateForm()">Next ‚û°</button>
                </div>
            </div>
        </div>

        <div id="lang-popup" class="hidden">
            <h2 style="font-size: 1.5rem; margin-bottom: 20px;">Choose Language<br>‡¥≠‡¥æ‡¥∑ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</h2>
            <button class="btn-lang" onclick="setLanguage('en')">English</button>
            <button class="btn-lang" onclick="setLanguage('ml')" style="background: #e91e63; box-shadow: 0 4px 0 #c2185b;">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
        </div>

        <div id="game-interface" class="hidden">
            <div class="nav-header">
                <button id="btn-back" class="btn-back hidden" onclick="goBack()">‚¨Ö Back</button>
                <div class="progress-track"><div id="progress-bar"></div></div>
            </div>
            
            <div class="landscape"><span id="scene-emoji">üö©</span></div>
            <h2 id="scenario-text">Loading...</h2>
            <div class="options-grid" id="options-container"></div>
        </div>

        <div id="screen-result" class="hidden">
            <h2 id="res-header-text" style="color: var(--secondary); margin: 0; font-size: 1rem;">Analysis Complete!</h2>
            <div class="landscape" style="min-height: 90px; background: #fff; margin-bottom: 5px;">
                <span id="result-emoji" style="font-size: 3.5rem;">üèÜ</span>
            </div>
            <h1 id="result-title" style="color: var(--primary); font-size: 1.4rem; text-transform: uppercase; margin: 5px 0;">...</h1>
            
            <div class="details-box">
                <strong id="trait-label" style="color: #e65100;">‚ö° Your Personality:</strong>
                <div id="traits-list" style="margin-top:10px; font-size:0.95rem; color:#555;"></div>
            </div>

            <div class="career-box">
                <strong id="career-label" style="color: #2e7d32;">üöÄ Top 5 Future Careers:</strong>
                <ul id="career-list" style="padding:0; margin-top:10px;"></ul>
            </div>
            
            <div id="save-status" style="font-size:0.8rem; color:#888; margin-bottom:10px; min-height: 20px;"></div>
            
            <button id="btn-replay" class="btn-start" onclick="location.reload()" style="font-size: 0.9rem; padding: 10px 20px;">Play Again</button>
        </div>
    </div>

    <script>
        // --- 0. SUPABASE CONFIGURATION ---
        const SUPABASE_URL = "https://vtvpfpxofxgneitksxpf.supabase.co";
        const SUPABASE_ANON_KEY = "B1NNmJk8FACRw3Xghd_A_MpGSplI6"; 

        // Initialize Client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- GAME STATE ---
        let userInfo = {};
        let currentStep = 0;
        let scores = { Realistic: 0, Artistic: 0, Enterprising: 0, Social: 0 };
        let historyStack = [];
        let currentLang = 'en';

        // --- 1. UI TRANSLATIONS ---
        const uiText = {
            en: { back: "‚¨Ö Back", analysis: "Analysis Complete!", personality: "‚ö° Your Personality:", careers: "üöÄ Top 5 Future Careers:", replay: "Play Again", saving: "Saving result...", saved: "‚úÖ Result Saved!", error: "‚ö†Ô∏è Connection Error" },
            ml: { back: "‚¨Ö ‡¥™‡¥ø‡¥®‡µç‡¥®‡µã‡¥ü‡µç‡¥ü‡µç", analysis: "‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç ‡¥™‡µÇ‡µº‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥Ø‡¥ø!", personality: "‚ö° ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥µ‡µç‡¥Ø‡¥ï‡µç‡¥§‡¥ø‡¥§‡µç‡¥µ‡¥Ç:", careers: "üöÄ ‡¥Æ‡¥ø‡¥ï‡¥ö‡µç‡¥ö 5 ‡¥ú‡µã‡¥≤‡¥ø‡¥ï‡µæ:", replay: "‡¥µ‡µÄ‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥ï‡¥≥‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ç", saving: "‡¥∏‡µÇ‡¥ï‡µç‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ...", saved: "‚úÖ ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥ö‡µç‡¥ö‡µÅ!", error: "‚ö†Ô∏è ‡¥ï‡¥£‡¥ï‡µç‡¥∑‡µª ‡¥§‡¥ï‡¥∞‡¥æ‡µº" }
        };

        // --- 2. SMOOTH LOADING (FIXED) ---
        window.addEventListener('load', () => {
            const logo = document.getElementById('main-logo');
            const introPopup = document.getElementById('intro-popup');
            const content = document.getElementById('intro-content');
            const loader = document.getElementById('initial-loader');

            let isLoaded = false;

            const revealUI = () => {
                if (isLoaded) return; // Prevent double trigger
                isLoaded = true;
                
                loader.style.display = 'none';
                introPopup.style.opacity = 1; 
                content.classList.remove('hidden');
                content.classList.add('fade-in');
            };

            // 1. If image loads normally
            if (logo.complete) {
                revealUI();
            } else {
                logo.onload = revealUI;
                // If image fails to load (e.g. 404), reveal UI anyway!
                logo.onerror = revealUI;
            }

            // 2. Safety Timer: Force show after 2.5 seconds no matter what
            setTimeout(revealUI, 2500);
        });

        // --- 3. START SEQUENCE ---
        function validateForm() {
            const name = document.getElementById('inp-name').value;
            const stuClass = document.getElementById('inp-class').value;
            const age = document.getElementById('inp-age').value;
            const place = document.getElementById('inp-place').value;
            const phone = document.getElementById('inp-phone').value;

            if(!name || !stuClass || !age || !place || !phone) {
                alert("Please fill in all details!");
                return;
            }
            userInfo = { name, class: stuClass, age, place, phone };
            
            document.getElementById('intro-popup').classList.add('hidden');
            document.getElementById('lang-popup').classList.remove('hidden');
            document.getElementById('lang-popup').classList.add('fade-in');
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.getElementById('lang-popup').classList.add('hidden');
            document.getElementById('game-interface').classList.remove('hidden');
            document.getElementById('game-interface').classList.add('fade-in');
            document.getElementById('btn-back').innerText = uiText[lang].back;
            loadScenario();
        }

        /* --- 4. BILINGUAL CONTENT --- */
        const scenarios = [
            { text: "1. Village Center: What do you build first?", text_ml: "1. ‡¥ó‡µç‡¥∞‡¥æ‡¥Æ ‡¥ï‡µá‡¥®‡µç‡¥¶‡µç‡¥∞‡¥Ç: ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥Ü‡¥¶‡µç‡¥Ø‡¥Ç ‡¥é‡¥®‡µç‡¥§‡µç ‡¥®‡¥ø‡µº‡¥Æ‡µç‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç?", emoji: "üèóÔ∏è", options: [ { label: "Machine Shop", label_ml: "‡¥Æ‡µÜ‡¥∑‡µÄ‡µª ‡¥∑‡µã‡¥™‡µç‡¥™‡µç", type: "Realistic", icon: "üîß" }, { label: "Art School", label_ml: "‡¥Ü‡µº‡¥ü‡µç‡¥ü‡µç ‡¥∏‡µç‡¥ï‡µÇ‡µæ", type: "Artistic", icon: "üé®" }, { label: "Market", label_ml: "‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç", type: "Enterprising", icon: "üè™" }, { label: "Clinic", label_ml: "‡¥ï‡µç‡¥≤‡¥ø‡¥®‡¥ø‡¥ï‡µç‡¥ï‡µç", type: "Social", icon: "ü©∫" } ] },
            { text: "2. The bridge is broken! You...", text_ml: "2. ‡¥™‡¥æ‡¥≤‡¥Ç ‡¥§‡¥ï‡µº‡¥®‡µç‡¥®‡µÅ! ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥é‡¥®‡µç‡¥§‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥Ç?", emoji: "üåâ", options: [ { label: "Build a raft", label_ml: "‡¥ö‡¥ô‡µç‡¥ô‡¥æ‡¥ü‡¥Ç ‡¥â‡¥£‡µç‡¥ü‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Realistic", icon: "ü™µ" }, { label: "Call for help", label_ml: "‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Social", icon: "üì¢" }, { label: "Design a new one", label_ml: "‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥™‡µç‡¥≤‡¥æ‡µª ‡¥µ‡¥∞‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Artistic", icon: "üìê" }, { label: "Hire a boat", label_ml: "‡¥¨‡µã‡¥ü‡µç‡¥ü‡µç ‡¥µ‡¥æ‡¥ü‡¥ï‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µç ‡¥é‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Enterprising", icon: "üö§" } ] },
            { text: "3. Onam Festival role?", text_ml: "3. ‡¥ì‡¥£‡¥æ‡¥ò‡µã‡¥∑‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥±‡µã‡µæ?", emoji: "üå∏", options: [ { label: "Pookalam Design", label_ml: "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡¥≥‡¥Ç ‡¥°‡¥ø‡¥∏‡µà‡µª", type: "Artistic", icon: "üå∫" }, { label: "Serving Food", label_ml: "‡¥≠‡¥ï‡µç‡¥∑‡¥£‡¥Ç ‡¥µ‡¥ø‡¥≥‡¥Æ‡µç‡¥™‡µΩ", type: "Social", icon: "üçõ" }, { label: "Stage Setup", label_ml: "‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥ú‡µç ‡¥í‡¥∞‡µÅ‡¥ï‡µç‡¥ï‡µΩ", type: "Realistic", icon: "üî®" }, { label: "Event Organizer", label_ml: "‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥ü‡¥ø ‡¥®‡¥ü‡¥§‡µç‡¥§‡¥ø‡¥™‡µç‡¥™‡µç", type: "Enterprising", icon: "üé§" } ] },
            { text: "4. Tourists need help. You...", text_ml: "4. ‡¥µ‡¥ø‡¥®‡µã‡¥¶‡¥∏‡¥û‡µç‡¥ö‡¥æ‡¥∞‡¥ø‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥µ‡µá‡¥£‡¥Ç...", emoji: "üì∏", options: [ { label: "Drive the Jeep", label_ml: "‡¥ú‡µÄ‡¥™‡µç‡¥™‡µç ‡¥ì‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Realistic", icon: "üöô" }, { label: "Tell Stories", label_ml: "‡¥ï‡¥•‡¥ï‡µæ ‡¥™‡¥±‡¥Ø‡µÅ‡¥Ç", type: "Social", icon: "üó£Ô∏è" }, { label: "Sell Souvenirs", label_ml: "‡¥ï‡¥ö‡µç‡¥ö‡¥µ‡¥ü‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥Ç", type: "Enterprising", icon: "üí∞" }, { label: "Perform Dance", label_ml: "‡¥®‡µÉ‡¥§‡µç‡¥§‡¥Ç ‡¥Ö‡¥µ‡¥§‡¥∞‡¥ø‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Artistic", icon: "üíÉ" } ] },
            { text: "5. Lost Elephant! You...", text_ml: "5. ‡¥Ü‡¥®‡¥Ø‡µÜ ‡¥ï‡¥æ‡¥£‡¥æ‡¥®‡¥ø‡¥≤‡µç‡¥≤! ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ...", emoji: "üêò", options: [ { label: "Build Fence", label_ml: "‡¥µ‡µá‡¥≤‡¥ø ‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡µÅ‡¥Ç", type: "Realistic", icon: "üöß" }, { label: "Comfort It", label_ml: "‡¥Ö‡¥§‡¥ø‡¥®‡µÜ ‡¥∏‡¥Æ‡¥æ‡¥∂‡µç‡¥µ‡¥∏‡¥ø‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Social", icon: "‚ù§Ô∏è" }, { label: "Take Photos", label_ml: "‡¥´‡µã‡¥ü‡µç‡¥ü‡µã ‡¥é‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Artistic", icon: "üì∑" }, { label: "Lead Rescue", label_ml: "‡¥§‡¥ø‡¥∞‡¥ö‡µç‡¥ö‡¥ø‡¥≤‡¥ø‡¥®‡µç ‡¥®‡µá‡¥§‡µÉ‡¥§‡µç‡¥µ‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥Ç", type: "Enterprising", icon: "üö©" } ] },
            { text: "6. Coconut Harvest. You...", text_ml: "6. ‡¥§‡µá‡¥ô‡µç‡¥ô ‡¥µ‡¥ø‡¥≥‡¥µ‡µÜ‡¥ü‡µÅ‡¥™‡µç‡¥™‡µç. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ...", emoji: "ü••", options: [ { label: "Climb & Pluck", label_ml: "‡¥ï‡¥Ø‡¥±‡¥ø ‡¥™‡¥±‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Realistic", icon: "üßó" }, { label: "Count & Sell", label_ml: "‡¥é‡¥£‡µç‡¥£‡¥ø ‡¥µ‡¥ø‡µΩ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Enterprising", icon: "üìù" }, { label: "Make Crafts", label_ml: "‡¥ï‡¥∞‡¥ï‡µó‡¥∂‡¥≤ ‡¥µ‡¥∏‡µç‡¥§‡µÅ ‡¥â‡¥£‡µç‡¥ü‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Artistic", icon: "ü•£" }, { label: "Share with All", label_ml: "‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥µ‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥™‡¥ô‡µç‡¥ï‡¥ø‡¥ü‡µÅ‡¥Ç", type: "Social", icon: "ü§ù" } ] },
            { text: "7. School Club. You start...", text_ml: "7. ‡¥∏‡µç‡¥ï‡µÇ‡µæ ‡¥ï‡µç‡¥≤‡¥¨‡µç. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡µÅ‡¥®‡µç‡¥®‡¥§‡µç...", emoji: "üè´", options: [ { label: "Robotics", label_ml: "‡¥±‡µã‡¥¨‡µã‡¥ü‡µç‡¥ü‡¥ø‡¥ï‡µç‡¥∏‡µç", type: "Realistic", icon: "ü§ñ" }, { label: "Drama/Music", label_ml: "‡¥®‡¥æ‡¥ü‡¥ï‡¥Ç/‡¥ó‡¥æ‡¥®‡¥Ç", type: "Artistic", icon: "üé≠" }, { label: "Debate Team", label_ml: "‡¥°‡¥ø‡¥¨‡µá‡¥±‡µç‡¥±‡µç ‡¥ü‡µÄ‡¥Ç", type: "Enterprising", icon: "‚öñÔ∏è" }, { label: "Charity Club", label_ml: "‡¥∏‡µá‡¥µ‡¥® ‡¥ï‡µç‡¥≤‡¥¨‡µç", type: "Social", icon: "üåø" } ] },
            { text: "8. Plastic on beach. You...", text_ml: "8. ‡¥¨‡µÄ‡¥ö‡µç‡¥ö‡¥ø‡µΩ ‡¥™‡µç‡¥≤‡¥æ‡¥∏‡µç‡¥±‡µç‡¥±‡¥ø‡¥ï‡µç ‡¥ï‡¥£‡µç‡¥ü‡¥æ‡µΩ...", emoji: "üèñÔ∏è", options: [ { label: "Make Posters", label_ml: "‡¥™‡µã‡¥∏‡µç‡¥±‡µç‡¥±‡µº ‡¥µ‡¥∞‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Artistic", icon: "üñåÔ∏è" }, { label: "Pick it Up", label_ml: "‡¥™‡µÜ‡¥±‡µÅ‡¥ï‡µç‡¥ï‡¥ø ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µÅ‡¥Ç", type: "Realistic", icon: "üß§" }, { label: "Recycling Biz", label_ml: "‡¥±‡µÄ‡¥∏‡µà‡¥ï‡µç‡¥ï‡¥ø‡¥≥‡¥ø‡¥Ç‡¥ó‡µç ‡¥¨‡¥ø‡¥∏‡¥ø‡¥®‡¥∏‡µç", type: "Enterprising", icon: "‚ôªÔ∏è" }, { label: "Clean Together", label_ml: "‡¥ï‡µÇ‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡¥æ‡¥∞‡µÜ ‡¥ï‡µÇ‡¥ü‡µç‡¥ü‡¥ø ‡¥µ‡µÉ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç", type: "Social", icon: "üëØ" } ] },
            { text: "9. Boat Race Role?", text_ml: "9. ‡¥µ‡¥≥‡µç‡¥≥‡¥Ç‡¥ï‡¥≥‡¥ø‡¥Ø‡¥ø‡µΩ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥Ç?", emoji: "üö£", options: [ { label: "The Captain", label_ml: "‡¥ï‡µç‡¥Ø‡¥æ‡¥™‡µç‡¥±‡µç‡¥±‡µª", type: "Enterprising", icon: "üì¢" }, { label: "The Rower", label_ml: "‡¥§‡µÅ‡¥¥‡¥ö‡µç‡¥ö‡¥ø‡¥≤‡µÅ‡¥ï‡¥æ‡¥∞‡µª", type: "Realistic", icon: "üí™" }, { label: "Boat Decorator", label_ml: "‡¥µ‡¥≥‡µç‡¥≥‡¥Ç ‡¥Ö‡¥≤‡¥ô‡µç‡¥ï‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥Ø‡¥æ‡µæ", type: "Artistic", icon: "‚ú®" }, { label: "Cheerleader", label_ml: "‡¥Ü‡¥µ‡µá‡¥∂‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥Ø‡¥æ‡µæ", type: "Social", icon: "üéâ" } ] },
            { text: "10. Gift for Village?", text_ml: "10. ‡¥ó‡µç‡¥∞‡¥æ‡¥Æ‡¥§‡µç‡¥§‡¥ø‡¥®‡µç ‡¥é‡¥®‡µç‡¥§‡µç ‡¥∏‡¥Æ‡µç‡¥Æ‡¥æ‡¥®‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥Ç?", emoji: "üéÅ", options: [ { label: "Library", label_ml: "‡¥µ‡¥æ‡¥Ø‡¥®‡¥∂‡¥æ‡¥≤", type: "Social", icon: "üìö" }, { label: "Solar Plant", label_ml: "‡¥∏‡µã‡¥≥‡¥æ‡µº ‡¥™‡µç‡¥≤‡¥æ‡¥®‡µç‡¥±‡µç", type: "Realistic", icon: "‚òÄÔ∏è" }, { label: "Cinema", label_ml: "‡¥∏‡¥ø‡¥®‡¥ø‡¥Æ ‡¥§‡¥ø‡¥Ø‡µá‡¥±‡µç‡¥±‡µº", type: "Artistic", icon: "üé¨" }, { label: "Mall", label_ml: "‡¥Æ‡¥æ‡µæ (Mall)", type: "Enterprising", icon: "üõçÔ∏è" } ] },
            { text: "11. Pick an object!", text_ml: "11. ‡¥í‡¥®‡µç‡¥®‡µç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÇ!", emoji: "‚ö°", options: [ { label: "Microscope", label_ml: "‡¥Æ‡µà‡¥ï‡µç‡¥∞‡µã‡¥∏‡µç‡¥ï‡µã‡¥™‡µç‡¥™‡µç", type: "Realistic", icon: "üî¨" }, { label: "Paintbrush", label_ml: "‡¥¨‡µç‡¥∞‡¥∑‡µç", type: "Artistic", icon: "üñåÔ∏è" }, { label: "Megaphone", label_ml: "‡¥Æ‡µÜ‡¥ó‡¥æ‡¥´‡µã‡µ∫", type: "Enterprising", icon: "üì£" }, { label: "First Aid Kit", label_ml: "‡¥´‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥é‡¥Ø‡µç‡¥°‡µç ‡¥ï‡¥ø‡¥±‡µç‡¥±‡µç", type: "Social", icon: "ü©π" } ] },
            { text: "12. Pick a workspace!", text_ml: "12. ‡¥ú‡µã‡¥≤‡¥ø‡¥∏‡µç‡¥•‡¥≤‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÇ!", emoji: "‚ö°", options: [ { label: "Garage/Lab", label_ml: "‡¥ó‡¥æ‡¥∞‡µá‡¥ú‡µç/‡¥≤‡¥æ‡¥¨‡µç", type: "Realistic", icon: "‚öôÔ∏è" }, { label: "Studio", label_ml: "‡¥∏‡µç‡¥±‡µç‡¥±‡µÅ‡¥°‡¥ø‡¥Ø‡µã", type: "Artistic", icon: "üéª" }, { label: "Office", label_ml: "‡¥ì‡¥´‡µÄ‡¥∏‡µç", type: "Enterprising", icon: "üíº" }, { label: "Hospital", label_ml: "‡¥π‡µã‡¥∏‡µç‡¥™‡¥ø‡¥±‡µç‡¥±‡µΩ/‡¥∏‡µç‡¥ï‡µÇ‡µæ", type: "Social", icon: "üè•" } ] },
            { text: "13. Pick a hobby!", text_ml: "13. ‡¥í‡¥∞‡µÅ ‡¥π‡µã‡¥¨‡¥ø ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÇ!", emoji: "‚ö°", options: [ { label: "Fixing Bikes", label_ml: "‡¥µ‡¥æ‡¥π‡¥®‡¥Ç ‡¥®‡¥®‡µç‡¥®‡¥æ‡¥ï‡µç‡¥ï‡µΩ", type: "Realistic", icon: "üö≤" }, { label: "Writing Songs", label_ml: "‡¥™‡¥æ‡¥ü‡µç‡¥ü‡µÜ‡¥¥‡µÅ‡¥§‡µç‡¥§‡µç", type: "Artistic", icon: "üìù" }, { label: "Trading Cards", label_ml: "‡¥ï‡¥ö‡µç‡¥ö‡¥µ‡¥ü‡¥Ç/‡¥ü‡µç‡¥∞‡µá‡¥°‡¥ø‡¥ô‡µç‡¥ô‡µç", type: "Enterprising", icon: "üÉè" }, { label: "Teaching Kids", label_ml: "‡¥ï‡µÅ‡¥ü‡µç‡¥ü‡¥ø‡¥ï‡¥≥‡µÜ ‡¥™‡¥†‡¥ø‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µΩ", type: "Social", icon: "üë∂" } ] },
            { text: "14. Pick a hero!", text_ml: "14. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥π‡µÄ‡¥±‡µã?", emoji: "‚ö°", options: [ { label: "Inventor", label_ml: "‡¥ï‡¥£‡µç‡¥ü‡µÅ‡¥™‡¥ø‡¥ü‡µÅ‡¥§‡µç‡¥§‡¥ï‡µç‡¥ï‡¥æ‡¥∞‡µª", type: "Realistic", icon: "üí°" }, { label: "Artist", label_ml: "‡¥ï‡¥≤‡¥æ‡¥ï‡¥æ‡¥∞‡µª", type: "Artistic", icon: "üé≠" }, { label: "CEO", label_ml: "‡¥Æ‡µÅ‡¥§‡¥≤‡¥æ‡¥≥‡¥ø (CEO)", type: "Enterprising", icon: "üëî" }, { label: "Activist", label_ml: "‡¥∏‡¥æ‡¥Æ‡µÇ‡¥π‡µç‡¥Ø ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥ï‡µª", type: "Social", icon: "üïäÔ∏è" } ] },
            { text: "15. Final Choice!", text_ml: "15. ‡¥Ö‡¥µ‡¥∏‡¥æ‡¥® ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥Ç!", emoji: "üåü", options: [ { label: "Tools", label_ml: "‡¥â‡¥™‡¥ï‡¥∞‡¥£‡¥ô‡µç‡¥ô‡µæ", type: "Realistic", icon: "üî®" }, { label: "Colors", label_ml: "‡¥®‡¥ø‡¥±‡¥ô‡µç‡¥ô‡µæ", type: "Artistic", icon: "üåà" }, { label: "Money", label_ml: "‡¥™‡¥£‡¥Ç", type: "Enterprising", icon: "üí∞" }, { label: "People", label_ml: "‡¥Ü‡¥≥‡µÅ‡¥ï‡µæ", type: "Social", icon: "‚ù§Ô∏è" } ] }
        ];

        /* --- 5. GAME LOGIC --- */
        function loadScenario() {
            if (currentStep >= scenarios.length) { showResults(); return; }
            
            const backBtn = document.getElementById('btn-back');
            if(currentStep === 0) backBtn.classList.add('hidden');
            else backBtn.classList.remove('hidden');

            const data = scenarios[currentStep];
            document.getElementById('scenario-text').innerText = (currentLang === 'ml') ? data.text_ml : data.text;
            document.getElementById('scene-emoji').innerText = data.emoji;
            
            let shuffledOptions = [...data.options].sort(() => Math.random() - 0.5);
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            shuffledOptions.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'option-card';
                const displayLabel = (currentLang === 'ml') ? opt.label_ml : opt.label;
                btn.innerHTML = `<span style="font-size:1.5rem">${opt.icon}</span><strong style="margin-top:5px">${displayLabel}</strong>`;
                btn.onclick = () => handleChoice(opt.type);
                container.appendChild(btn);
            });
            document.getElementById('progress-bar').style.width = ((currentStep) / scenarios.length) * 100 + "%";
        }

        function handleChoice(type) { scores[type]++; historyStack.push(type); currentStep++; loadScenario(); }
        
        function goBack() {
            if (currentStep <= 0) return;
            const lastType = historyStack.pop();
            if (lastType) scores[lastType]--;
            currentStep--;
            loadScenario();
        }

        /* --- 6. RESULTS LOGIC --- */
        function showResults() {
            document.getElementById('game-interface').classList.add('hidden');
            const resScreen = document.getElementById('screen-result');
            resScreen.classList.remove('hidden');
            resScreen.classList.add('fade-in');

            document.getElementById('res-header-text').innerText = uiText[currentLang].analysis;
            document.getElementById('trait-label').innerText = uiText[currentLang].personality;
            document.getElementById('career-label').innerText = uiText[currentLang].careers;
            document.getElementById('btn-replay').innerText = uiText[currentLang].replay;

            let sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            let topTrait = sortedScores[0][0];
            let secondTrait = sortedScores[1][0];

            const hybridData = {
                "Realistic-Artistic": { title: "The Design Engineer üìê", title_ml: "‡¥°‡¥ø‡¥∏‡µà‡µª ‡¥é‡¥û‡µç‡¥ö‡¥ø‡¥®‡µÄ‡¥Ø‡µº üìê", career: ["Architect", "Product Designer", "Animator"], career_ml: ["‡¥Ü‡µº‡¥ï‡µç‡¥ï‡¥ø‡¥ü‡µÜ‡¥ï‡µç‡¥±‡µç‡¥±‡µç", "‡¥â‡µΩ‡¥™‡µç‡¥™‡¥®‡µç‡¥® ‡¥°‡¥ø‡¥∏‡µà‡¥®‡µº", "‡¥Ö‡¥®‡¥ø‡¥Æ‡µá‡¥±‡µç‡¥±‡µº"] },
                "Realistic-Social": { title: "The Medical Healer ü©∫", title_ml: "‡¥Æ‡µÜ‡¥°‡¥ø‡¥ï‡µç‡¥ï‡µΩ ‡¥π‡µÄ‡¥≤‡µº (‡¥°‡µã‡¥ï‡µç‡¥ü‡µº) ü©∫", career: ["Surgeon", "Veterinarian", "Physiotherapist"], career_ml: ["‡¥∏‡µº‡¥ú‡µª", "‡¥µ‡µÜ‡¥±‡µç‡¥±‡¥±‡¥ø‡¥®‡¥±‡¥ø ‡¥°‡µã‡¥ï‡µç‡¥ü‡µº", "‡¥´‡¥ø‡¥∏‡¥ø‡¥Ø‡µã‡¥§‡µÜ‡¥±‡¥æ‡¥™‡µç‡¥™‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç"] },
                "Realistic-Enterprising": { title: "The Builder Captain üèóÔ∏è", title_ml: "‡¥¨‡¥ø‡µΩ‡¥°‡µº ‡¥ï‡µç‡¥Ø‡¥æ‡¥™‡µç‡¥±‡µç‡¥±‡µª üèóÔ∏è", career: ["Pilot", "Civil Engineer", "Factory Manager"], career_ml: ["‡¥™‡µà‡¥≤‡¥±‡µç‡¥±‡µç", "‡¥∏‡¥ø‡¥µ‡¥ø‡µΩ ‡¥é‡¥û‡µç‡¥ö‡¥ø‡¥®‡µÄ‡¥Ø‡µº", "‡¥´‡¥æ‡¥ï‡µç‡¥ü‡¥±‡¥ø ‡¥Æ‡¥æ‡¥®‡µá‡¥ú‡µº"] },
                "Artistic-Realistic": { title: "The Digital Creator üíª", title_ml: "‡¥°‡¥ø‡¥ú‡¥ø‡¥±‡µç‡¥±‡µΩ ‡¥ï‡µç‡¥∞‡¥ø‡¥Ø‡µá‡¥±‡µç‡¥±‡µº üíª", career: ["UX/UI Designer", "Sound Engineer", "Photographer"], career_ml: ["UX/UI ‡¥°‡¥ø‡¥∏‡µà‡¥®‡µº", "‡¥∏‡µó‡¥£‡µç‡¥ü‡µç ‡¥é‡¥û‡µç‡¥ö‡¥ø‡¥®‡µÄ‡¥Ø‡µº", "‡¥´‡µã‡¥ü‡µç‡¥ü‡µã‡¥ó‡µç‡¥∞‡¥æ‡¥´‡µº"] },
                "Artistic-Social": { title: "The Inspiring Teacher üé≠", title_ml: "‡¥Ö‡¥ß‡µç‡¥Ø‡¥æ‡¥™‡¥ï‡µª / ‡¥ï‡¥≤‡¥æ‡¥ï‡¥æ‡¥∞‡µª üé≠", career: ["Drama Teacher", "Art Therapist", "Journalist"], career_ml: ["‡¥Ö‡¥ß‡µç‡¥Ø‡¥æ‡¥™‡¥ï‡µª", "‡¥Ü‡µº‡¥ü‡µç‡¥ü‡µç ‡¥§‡µÜ‡¥±‡¥æ‡¥™‡µç‡¥™‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç", "‡¥Æ‡¥æ‡¥ß‡µç‡¥Ø‡¥Æ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥ï‡µª"] },
                "Artistic-Enterprising": { title: "The Media Star üé¨", title_ml: "‡¥Æ‡µÄ‡¥°‡¥ø‡¥Ø ‡¥∏‡µç‡¥±‡µç‡¥±‡¥æ‡µº üé¨", career: ["Film Director", "Advertising Head", "Influencer"], career_ml: ["‡¥∏‡¥Ç‡¥µ‡¥ø‡¥ß‡¥æ‡¥Ø‡¥ï‡µª", "‡¥™‡¥∞‡¥∏‡µç‡¥Ø‡¥∞‡¥Ç‡¥ó‡¥Ç", "‡¥∏‡µã‡¥∑‡µç‡¥Ø‡µΩ ‡¥Æ‡µÄ‡¥°‡¥ø‡¥Ø ‡¥á‡µª‡¥´‡µç‡¥≤‡µÅ‡¥µ‡µª‡¥∏‡µº"] },
                "Social-Realistic": { title: "The Hands-on Helper üöë", title_ml: "‡¥∏‡µá‡¥µ‡¥® ‡¥∏‡¥®‡µç‡¥®‡¥¶‡µç‡¥ß‡µª üöë", career: ["Nurse", "Police Officer", "Paramedic"], career_ml: ["‡¥®‡¥¥‡µç‡¥∏‡µç", "‡¥™‡µã‡¥≤‡µÄ‡¥∏‡µç ‡¥ì‡¥´‡µÄ‡¥∏‡µº", "‡¥™‡¥æ‡¥∞‡¥æ‡¥Æ‡µÜ‡¥°‡¥ø‡¥ï‡µç"] },
                "Social-Artistic": { title: "The Storyteller üó£Ô∏è", title_ml: "‡¥ï‡¥•‡¥æ‡¥ï‡¥æ‡¥∞‡µª / ‡¥∏‡µà‡¥ï‡µç‡¥ï‡µã‡¥≥‡¥ú‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç üó£Ô∏è", career: ["Psychologist", "Librarian", "Writer"], career_ml: ["‡¥∏‡µà‡¥ï‡µç‡¥ï‡µã‡¥≥‡¥ú‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç", "‡¥≤‡µà‡¥¨‡µç‡¥∞‡µá‡¥±‡¥ø‡¥Ø‡µª", "‡¥é‡¥¥‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥ï‡¥æ‡¥∞‡µª"] },
                "Social-Enterprising": { title: "The Team Leader ü§ù", title_ml: "‡¥ü‡µÄ‡¥Ç ‡¥≤‡µÄ‡¥°‡µº ü§ù", career: ["School Principal", "HR Manager", "NGO Leader"], career_ml: ["‡¥™‡µç‡¥∞‡¥ø‡µª‡¥∏‡¥ø‡¥™‡µç‡¥™‡µΩ", "HR ‡¥Æ‡¥æ‡¥®‡µá‡¥ú‡µº", "NGO ‡¥≤‡µÄ‡¥°‡µº"] },
                "Enterprising-Realistic": { title: "The Tech Boss üöÄ", title_ml: "‡¥ü‡µÜ‡¥ï‡µç ‡¥¨‡µã‡¥∏‡µç üöÄ", career: ["Startup Founder", "Stock Trader", "Real Estate"], career_ml: ["‡¥∏‡µç‡¥±‡µç‡¥±‡¥æ‡µº‡¥ü‡µç‡¥ü‡¥™‡µç‡¥™‡µç ‡¥´‡µó‡¥£‡µç‡¥ü‡µº", "‡¥∏‡µç‡¥±‡µç‡¥±‡µã‡¥ï‡µç‡¥ï‡µç ‡¥ü‡µç‡¥∞‡µá‡¥°‡µº", "‡¥±‡¥ø‡¥Ø‡µΩ ‡¥é‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥±‡µç‡¥±‡µç"] },
                "Enterprising-Artistic": { title: "The Visionary üí°", title_ml: "‡¥µ‡¥ø‡¥∑‡¥®‡¥±‡¥ø (‡¥ï‡¥æ‡¥¥‡µç‡¥ö‡¥™‡µç‡¥™‡¥æ‡¥ü‡µÅ‡¥≥‡µç‡¥≥‡¥Ø‡¥æ‡µæ) üí°", career: ["Marketing Director", "Creative Director", "Publicist"], career_ml: ["‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡¥ø‡¥Ç‡¥ó‡µç ‡¥°‡¥Ø‡¥±‡¥ï‡µç‡¥ü‡µº", "‡¥ï‡µç‡¥∞‡¥ø‡¥Ø‡µá‡¥±‡µç‡¥±‡µÄ‡¥µ‡µç ‡¥°‡¥Ø‡¥±‡¥ï‡µç‡¥ü‡µº", "‡¥™‡¥¨‡µç‡¥≤‡¥ø‡¥∏‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç"] },
                "Enterprising-Social": { title: "The Public Leader üèõÔ∏è", title_ml: "‡¥™‡µä‡¥§‡µÅ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥ï‡µª üèõÔ∏è", career: ["Politician", "Lawyer", "Social Entrepreneur"], career_ml: ["‡¥∞‡¥æ‡¥∑‡µç‡¥ü‡µç‡¥∞‡µÄ‡¥Ø‡¥ï‡µç‡¥ï‡¥æ‡¥∞‡µª", "‡¥µ‡¥ï‡µç‡¥ï‡µÄ‡µΩ", "‡¥∏‡µã‡¥∑‡µç‡¥Ø‡µΩ ‡¥é‡¥®‡µç‡¥±‡µº‡¥™‡µç‡¥∞‡¥£‡µº"] }
            };

            let key = topTrait + "-" + secondTrait;
            let profile = hybridData[key] || { title: "The Master " + topTrait, title_ml: topTrait + " ‡¥µ‡¥ø‡¥¶‡¥ó‡µç‡¥¶‡µç‡¥ß‡µª", career: ["Specialist", "Researcher"], career_ml: ["‡¥∏‡µç‡¥™‡µÜ‡¥∑‡µç‡¥Ø‡¥≤‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç", "‡¥ó‡¥µ‡µá‡¥∑‡¥ï‡µª"] };

            document.getElementById('result-title').innerText = (currentLang === 'ml') ? profile.title_ml : profile.title;
            
            const traitsEn = { "Realistic": "Tool User", "Artistic": "Creative", "Social": "Helper", "Enterprising": "Leader" };
            const traitsMl = { "Realistic": "‡¥â‡¥™‡¥ï‡¥∞‡¥£‡¥ô‡µç‡¥ô‡µæ ‡¥á‡¥∑‡µç‡¥ü‡¥Ç", "Artistic": "‡¥∏‡µº‡¥ó‡µç‡¥ó‡¥æ‡¥§‡µç‡¥Æ‡¥ï‡¥§", "Social": "‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø", "Enterprising": "‡¥®‡µá‡¥§‡¥æ‡¥µ‡µç" };
            const tMap = (currentLang === 'ml') ? traitsMl : traitsEn;

            document.getElementById('traits-list').innerHTML = `<div style="margin-bottom:5px">‚úÖ ${tMap[topTrait]}</div><div>‚ú® ${tMap[secondTrait]}</div>`;
            const cList = document.getElementById('career-list');
            cList.innerHTML = "";
            const careersToShow = (currentLang === 'ml') ? profile.career_ml : profile.career;
            careersToShow.forEach(c => { cList.innerHTML += `<li class="career-li">${c}</li>`; });

            saveToSupabase(profile.title, topTrait, scores);
        }

        async function saveToSupabase(resultTitle, topTrait, fullScores) {
            const statusBox = document.getElementById('save-status');
            statusBox.innerText = uiText[currentLang].saving;

            try {
                // IMPORTANT: The names on the LEFT (student_name, etc.) must match your SUPABASE TABLE columns.
                const { data, error } = await supabase
                    .from('career_results')
                    .insert([
                        { 
                            student_name: userInfo.name,
                            student_class: userInfo.class,
                            age: userInfo.age,
                            place: userInfo.place,
                            phone: userInfo.phone,
                            result_title: resultTitle,
                            top_trait: topTrait,
                            scores_json: JSON.stringify(fullScores)
                        }
                    ]);

                if (error) throw error;

                statusBox.innerText = uiText[currentLang].saved;
                statusBox.style.color = "green";
                
                // Debugging Success
                console.log("‚úÖ Success! Data saved:", data);

            } catch (err) {
                console.error("‚ùå Supabase Error Details:", err);
                statusBox.innerText = uiText[currentLang].error + " (Check Console)";
                statusBox.style.color = "red";
                alert("Database Error: " + err.message + "\nPlease check the Console (F12) for more details.");
            }
        }
    </script>
</body>
</html>
